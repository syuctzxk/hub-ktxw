# 1. 对多模态RAG的项目，设计下接口，需要满足：数据管理的接口、多模态检索接口、多模态问答接口, 接口定义定义清楚，传入的参数 + 返回的结果格式
    数据管理的接口：包括添加、删除、更新、查询数据的接口
        添加数据接口：传入数据（文本、图、表），返回添加成功的消息
            参数：data（文本、图、表的内容）
            返回：success message（添加成功的消息）
    ```python
        #  入参
        {
            "data": {
                "text": "这是一条文本数据",
                "image": "base64编码的图数据",
                "table": "表格数据"
            }
        }
        #  出参
        {"message": "数据添加成功"}
    ```

        删除数据接口：传入数据ID，返回删除成功的消息
            参数：data_id（要删除的数据ID）
            返回：success message（删除成功的消息） 
    ```python
        #  入参
        {
            "data_id": "123456"
        }
        #  出参
        {"message": "数据删除成功"}
    ```


        更新数据接口：传入数据ID和更新后的内容，返回更新成功的消息
            参数：data_id（要更新的数据ID）
                 updated_data（更新后的文本、图、表内容）
            返回：success message（更新成功的消息）
    ```python
        #  入参
        {
            "data_id": "123456",
            "updated_data": {
                "text": "更新后的文本数据",
                "image": "base64编码的更新后的图数据",
                "table": "更新后的表格数据"
            }
        }
        #  出参
        {"message": "数据更新成功"}
    ```


        查询数据接口：传入查询条件（如数据类型、关键词），返回符合条件的数据列表
            参数：query（查询条件，如数据类型、关键词）
            返回：data list（符合条件的数据列表）
    ```python
        #  入参
        {
            "query": {
                "type": "text",
                "keywords": ["关键词1", "关键词2"]
            
                }
        }
        #  出参
        {
            "data_list": [
                {
                    "id": "123456",
                    "type": "text",
                    "content": "这是一条文本数据"
                },
                {
                    "id": "789012",
                    "type": "image",
                    "content": "base64编码的图数据"
                }
            ]
        }
    ```
- 多模态检索接口：根据用户输入的文本或文本+图，返回相关的文本、图、表
    - 文本检索接口：传入文本查询关键词，返回相关的文本列表
        - 参数：query（文本查询关键词）
        - 返回：text list（相关的文本列表）
        ```python
            #  入参
            {
                "query": {
                    "text": "这是一条查询文本",
                    "image": "base64编码的查询图数据
                }

            }
            #  出参
            {
                "text_list": [
                    {
                        "id": "123456",
                        "type": "text",
                        "content": "这是一条文本数据"
                    }
                ]
                "image_list": [
                    {
                        "id": "789012",
                        "type": "image",
                        "content": "base64编码的图数据"
                    }
                ]
            }
        ```
        
- 文本+图检索接口：传入文本查询关键词和图查询条件，返回相关的文本、图、表列表 
    - 参数：
        - query（文本查询关键词）
        - image_query（图查询条件，如图的描述）
    - 返回：
        - text list（相关的文本列表） 
        - image list（相关的图列表）
        - table list（相关的表列表）    
```python
        #  入参
        {
            "query": {
                "text": "这是一条查询文本",
            }
            "image_query": {
                "image": "base64编码的查询图数据",
                "description": "这是一张查询图"
                }

        }
        #  出参
        {
            "text_list": [
                {
                    "id": "123456",
                    "type": "text",
                    "content": "这是一条文本数据"
                }
            ],
            "image_list": [
                {
                    "id": "789012",
                    "type": "image",
                    "content": "base64编码的图数据"
                }
            ],
            "table_list": [
                {
                    "id": "456789",
                    "type": "table",
                    "content": "表格数据"
                }
            ]
        }
```
- 多模态问答接口：根据用户输入的文本或文本+图，返回相关的回答
    - 文本问答接口：传入文本查询关键词，返回相关的回答
        - 参数：query（文本查询关键词）
        - 返回：answer（相关的回答）
        ```python
            #  入参
            {
                "query": {
                    "text": "这是一条查询文本",
                }，
                "image_query": {
                    "image": "base64编码的查询图数据",
                    "description": "这是一张查询图"
                }
            }
            #  出参
            {"answer": "这是一条相关的回答"}
        ```
- 文本+图问答接口：传入文本查询关键词和图查询条件，返回相关的回答
    - 参数：
        - query（文本查询关键词）
        - image_query（图查询条件，如图的描述）
    - 返回：answer（相关的回答）
        ```python
            #  入参
            {
                "query": {
                    "text": "这是一条查询文本",
                }，
                "image_query": {
                    "image": "base64编码的查询图数据",
                    "description": "这是一张查询图"
                }
            }
            #  出参
            {"answer": "这是一条相关的回答"}
        ```



# 2. 对多模态RAG的项目，如果用户使用【文本】提问 vs 【文本 + 图】提问，你会怎么处理？有什么区别？

```python
文本提问:    1. 直接使用bge编码，检索文本向量库
            2. 使用clip 特征相似度，检索图向量库
            3. 合并文本、图、表的回答，返回给用户
文本+图提问:  1. 先使用qwen-vl 描述为文本，再使用bge编码，检索文本向量库
            2. 先使用clip 特征相似度，检索图向量库
            3. 合并文本、图、表的回答，返回给用户
```




# 3. 对多模态RAG的项目，milvus如果要存储文本、图、表，数据结构如何设计？



## 方案一：多集合设计（推荐）

### 文本数据集合 (multimodal_text)

| 字段名 | 数据类型 | 说明 | 配置参数 |
|--------|----------|------|----------|
| id | VARCHAR | 主键 | max_length=100, is_primary=True |
| text_content | VARCHAR | 文本内容 | max_length=65535 |
| text_vector | FLOAT_VECTOR | 文本嵌入向量 | dim=768 |
| metadata | JSON | 元数据信息 | - |
| source_id | VARCHAR | 关联源文档ID | max_length=100 |
| chunk_index | INT64 | 文本块索引 | - |
| created_time | INT64 | 创建时间戳 | - |

### 图像数据集合 (multimodal_image)

| 字段名 | 数据类型 | 说明 | 配置参数 |
|--------|----------|------|----------|
| id | VARCHAR | 主键 | max_length=100, is_primary=True |
| image_path | VARCHAR | 图像存储路径 | max_length=1000 |
| image_description | VARCHAR | 图像描述文本 | max_length=2000 |
| image_vector | FLOAT_VECTOR | 图像特征向量 | dim=512 |
| text_vector | FLOAT_VECTOR | 描述文本向量 | dim=768 |
| metadata | JSON | 元数据信息 | - |
| source_id | VARCHAR | 关联源文档ID | max_length=100 |
| created_time | INT64 | 创建时间戳 | - |

### 表格数据集合 (multimodal_table)

| 字段名 | 数据类型 | 说明 | 配置参数 |
|--------|----------|------|----------|
| id | VARCHAR | 主键 | max_length=100, is_primary=True |
| table_content | VARCHAR | 表格内容(JSON格式) | max_length=65535 |
| table_summary | VARCHAR | 表格摘要描述 | max_length=4000 |
| table_vector | FLOAT_VECTOR | 表格语义向量 | dim=768 |
| metadata | JSON | 元数据信息 | - |
| source_id | VARCHAR | 关联源文档ID | max_length=100 |
| created_time | INT64 | 创建时间戳 | - |

## 方案二：单集合多向量设计

### 统一多模态集合 (multimodal_unified)

| 字段名 | 数据类型 | 说明 |
|--------|----------|------|
| id | VARCHAR | 主键 | max_length=100, is_primary=True |
| content_type | VARCHAR | 内容类型 | max_length=20 |
| raw_content | VARCHAR | 原始内容 | max_length=65535 |
| description | VARCHAR | 内容描述 | max_length=4000 |
| text_vector | FLOAT_VECTOR | 文本语义向量 | dim=768 |
| image_vector | FLOAT_VECTOR | 图像特征向量 | dim=512 |
| table_vector | FLOAT_VECTOR | 表格语义向量 | dim=768 |
| metadata | JSON | 元数据信息 | - |
| source_path | VARCHAR | 源文件路径 | max_length=1000 |
| created_time | INT64 | 创建时间戳 | - |



