## task02
> 本地尝试部署下mineru，进行pdf文档解析；
> 
> 如果本地无法部署，则使用云端的环境api； 
> 
> 使用mineru 工具对一个pdf/word进行解析，然后对这个文档进行rag问答；

### mineru
**安装**
```bash
pip install uv -i https://mirrors.aliyun.com/pypi/simple
uv pip install -U "mineru[core]" -i https://mirrors.aliyun.com/pypi/simple
```
**使用**
```bash
# 本地使用
mineru -p <input_path> -o <output_path>
# api使用
mineru-api --host 0.0.0.0 --port 8000
```

### 任务分解与RAG系统实现方案

#### 1. 任务分解（最细不可再分任务）

根据您的需求，我将使用MinerU进行文档解析并结合FAISS实现RAG系统的任务分解如下：

| 阶段 | 最细粒度任务 | 描述                                   |
|------|-------------|--------------------------------------|
| **环境准备** | 1.1 验证Python 3.12环境 | 确认conda环境已激活且版本正确                    |
| | 1.2 安装必要依赖包 | 安装sentence_transformers, faiss-cpu, openai等库 |
| | 1.3 配置MinerU环境 | 确认MinerU已正确部署且可调用                    |
| **文档解析** | 2.1 输入文档路径验证 | 检查PDF/Word文件是否存在且可读                  |
| | 2.2 调用MinerU解析接口 | 使用命令行或API方式调用MinerU                  |
| | 2.3 解析结果提取 | 从MinerU输出中提取纯文本内容                    |
| | 2.4 解析结果存储 | 将解析内容保存为中间文件                         |
| **文本处理** | 3.1 文本清洗预处理 | 去除多余空格、特殊字符、标准化格式                    |
| | 3.2 文本分割 chunking | 按固定大小或语义边界分割文本                       |
| | 3.3 分割质量验证 | 检查块大小是否合理、内容是否连贯                     |
| **向量化处理** | 4.1 选择嵌入模型 | 确定使用的text embedding模型                |
| | 4.2 文本向量化转换 | 将文本块转换为向量表示                          |
| | 4.3 FAISS索引构建 | 创建向量数据库索引                            |
| | 4.4 索引持久化存储 | 将向量索引保存到本地文件                         |
| **RAG查询处理** | 5.1 用户查询接收 | 获取用户输入问题                             |
| | 5.2 查询向量化 | 将查询文本转换为向量                           |
| | 5.3 相似性检索 | 在FAISS中查找最相关的文本块                     |
| | 5.4 检索结果排序 | 按相似度对结果进行排序                          |
| | 5.5 上下文构造 | 组合检索结果形成提示上下文                        |
| **答案生成** | 6.1 LLM模型初始化 | 配置选择的语言模型                            |
| | 6.2 提示模板构建 | 设计RAG提示模板结构                          |
| | 6.3 生成参数配置 | 设置temperature、max_tokens等参数          |
| | 6.4 调用模型生成答案 | 执行LLM推理生成最终回答                        |
| | 6.5 结果后处理 | 对生成答案进行格式化和验证                        |
| **系统集成** | 7.1 模块间接口定义 | 确定各模块数据传递格式                          |
| | 7.2 错误处理机制 | 设计异常处理和重试逻辑                          |
| | 7.3 日志记录系统 | 实现运行日志记录功能                           |
| | 7.4 性能优化调整 | 优化处理速度和资源使用                          |

#### 2. 模块划分

基于上述任务分解，我将系统划分为以下5个核心模块：

| 模块名 | 功能描述 | 包含的主要任务 |
|--------|----------|----------------|
| **document_parser.py** | 文档解析模块 | 2.1-2.4：处理MinerU调用和文档解析 |
| **text_processor.py** | 文本处理模块 | 3.1-3.3：文本清洗、分割和预处理 |
| **vector_indexer.py** | 向量索引模块 | 4.1-4.4：向量化处理和FAISS索引构建 |
| **rag_engine.py** | RAG引擎模块 | 5.1-5.5, 6.1-6.5：检索和生成核心逻辑 |
| **main.py** | 主控模块 | 1.1-1.3, 7.1-7.4：系统集成和流程控制 |

