## 多模态RAG系统数据管理接口设计

## 一.数据管理的接口

### 1. 文档上传接口

#### 接口功能

上传并解析多模态文档，提取文本和多媒体内容，构建向量索引

请求参数

```json
POST /api/v1/documents/upload

// Headers
Content-Type: multipart/form-data
Authorization: Bearer {token}

// Body (form-data)
{
  "file": File,                    // 必需，支持的文件类型: pdf, docx, pptx, txt, jpg, png, mp3, mp4等
  "collection_id": string,         // 可选，指定存储集合
  "metadata": {                    // 可选，文档元数据
    "title": string,
    "description": string,
    "tags": string[],
    "category": string,
    "language": string,           // 文档语言，如: zh-CN, en-US
    "access_level": "public" | "private" | "team"
  },
  "processing_config": {           // 可选，处理配置
    "extract_text": boolean,      // 是否提取文本
    "extract_images": boolean,    // 是否提取图像
    "generate_summary": boolean,  // 是否生成摘要
    "chunk_size": number,         // 文本分块大小
    "chunk_overlap": number       // 文本分块重叠大小
  }
}
```

响应结果：

```json
{
  "success": boolean,
  "data": {
    "document_id": string,
    "collection_id": string,
    "file_name": string,
    "file_size": number,
    "file_type": string,
    "processing_result": {
      "status": "success" | "processing" | "failed",
      "text_chunks": number,           // 生成的文本块数量
      "image_chunks": number,          // 提取的图像数量
      "audio_chunks": number,          // 音频片段数量
      "video_chunks": number,          // 视频片段数量
      "summary": string,               // 文档摘要
      "metadata": object               // 提取的元数据
    },
    "vector_ids": string[],           // 生成的向量ID列表
    "created_at": string,             // ISO时间戳
    "processing_time": number         // 处理耗时(ms)
  },
  "error": {
    "code": string,
    "message": string,
    "details": object
  }
}
```



### 2. 批量文档上传接口

### 接口功能

批量上传多个文档，支持异步处理。

### 请求参数

```json
POST /api/v1/documents/batch-upload

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "documents": [
    {
      "file_url": string,           // 文件URL或base64编码
      "file_name": string,
      "file_type": string,
      "metadata": object,
      "processing_config": object
    }
  ],
  "collection_id": string,
  "async_processing": boolean,      // 是否异步处理
  "callback_url": string            // 异步处理完成回调URL
}
```

### 响应结果

```json
{
  "success": boolean,
  "data": {
    "batch_id": string,
    "total_documents": number,
    "processing_documents": number,
    "failed_documents": number,
    "documents": [
      {
        "document_id": string,
        "file_name": string,
        "status": "queued" | "processing" | "completed" | "failed",
        "error_message": string
      }
    ],
    "estimated_completion_time": string  // 预计完成时间
  }
}
```



### 3. 文档查询接口

### 接口功能

根据条件查询已上传的文档信息。

### 请求参数

```json
GET /api/v1/documents

// Query Parameters
{
  "collection_id": string,         // 可选，过滤集合
  "file_type": string,             // 可选，文件类型过滤
  "tags": string[],                // 可选，标签过滤
  "category": string,              // 可选，分类过滤
  "start_date": string,            // 可选，创建时间范围起始
  "end_date": string,              // 可选，创建时间范围结束
  "page": number,                  // 分页页码，默认1
  "page_size": number,             // 每页数量，默认20
  "sort_by": "created_at" | "file_size" | "file_name",
  "sort_order": "asc" | "desc"
}
```

### 响应结果

```json
{
  "success": boolean,
  "data": {
    "documents": [
      {
        "document_id": string,
        "file_name": string,
        "file_type": string,
        "file_size": number,
        "collection_id": string,
        "metadata": object,
        "processing_status": string,
        "chunk_count": number,
        "vector_count": number,
        "created_at": string,
        "updated_at": string
      }
    ],
    "pagination": {
      "page": number,
      "page_size": number,
      "total_count": number,
      "total_pages": number
    }
  }
}
```

### 4. 文档删除接口

### 接口功能

删除指定文档及其相关的所有向量数据。

### 请求参数

```json
DELETE /api/v1/documents/{document_id}

// Headers
Authorization: Bearer {token}
```

### 响应结果

```json
{
  "success": boolean,
  "data": {
    "document_id": string,
    "deleted_chunks": number,       // 删除的文本块数量
    "deleted_vectors": number,      // 删除的向量数量
    "deleted_files": number         // 删除的物理文件数量
  },
  "error": {
    "code": "DOCUMENT_NOT_FOUND" | "DELETE_FAILED",
    "message": string
  }
}
```

### 5. 集合管理接口

### 5.1 创建集合

```json
POST /api/v1/collections

// Body
{
  "name": string,                   // 集合名称
  "description": string,            // 集合描述
  "vector_config": {                // 向量配置
    "model": string,                // 向量化模型
    "dimension": number,            // 向量维度
    "distance_metric": "cosine" | "euclidean" | "dot"
  },
  "metadata_schema": object,        // 元数据模式定义
  "access_control": {               // 访问控制
    "public_read": boolean,
    "allowed_users": string[],
    "allowed_teams": string[]
  }
}
```

### 5.2 查询集合列表

```json
GET /api/v1/collections

// 响应
{
  "success": boolean,
  "data": {
    "collections": [
      {
        "collection_id": string,
        "name": string,
        "description": string,
        "document_count": number,
        "vector_count": number,
        "created_at": string,
        "updated_at": string
      }
    ]
  }
}
```

### 5.3 删除集合

```json
DELETE /api/v1/collections/{collection_id}

// 响应
{
  "success": boolean,
  "data": {
    "collection_id": string,
    "deleted_documents": number,
    "deleted_vectors": number
  }
}
```

### 6. 数据统计接口

### 接口功能

获取系统数据统计信息。

### 请求参数

```json
GET /api/v1/statistics

// Query Parameters
{
  "time_range": "day" | "week" | "month" | "year",
  "collection_id": string
}
```

### 响应结果

```json
{
  "success": boolean,
  "data": {
    "storage": {
      "total_documents": number,
      "total_collections": number,
      "total_vectors": number,
      "storage_size": number,           // 存储空间大小(字节)
      "vector_storage_size": number     // 向量存储大小(字节)
    },
    "file_types": {
      "pdf": number,
      "docx": number,
      "image": number,
      "audio": number,
      "video": number,
      "other": number
    },
    "processing_stats": {
      "success_rate": number,           // 处理成功率
      "average_processing_time": number, // 平均处理时间
      "failed_count": number            // 失败数量
    },
    "usage_trends": {
      "documents_uploaded": number[],   // 时间序列数据
      "vectors_generated": number[],
      "storage_used": number[]
    }
  }
}
```

### 7. 数据备份接口

### 接口功能

触发数据备份操作。

### 请求参数

```json
POST /api/v1/backup

// Body
{
  "backup_type": "full" | "incremental",
  "include_vectors": boolean,
  "storage_target": "local" | "cloud" | "both",
  "compression": boolean
}
```

响应结果

```json
{
  "success": boolean,
  "data": {
    "backup_id": string,
    "backup_size": number,
    "estimated_duration": number,
    "backup_files": string[],
    "download_url": string
  }
}
```

### 错误码说明

| 错误码                   | 描述             | 解决方案         |
| :----------------------- | :--------------- | :--------------- |
| `INVALID_FILE_TYPE`      | 不支持的文件类型 | 检查上传文件格式 |
| `FILE_SIZE_EXCEEDED`     | 文件大小超限     | 压缩或分片上传   |
| `PROCESSING_FAILED`      | 文档处理失败     | 检查文档内容格式 |
| `STORAGE_QUOTA_EXCEEDED` | 存储空间不足     | 清理空间或扩容   |
| `VECTOR_INDEX_ERROR`     | 向量索引错误     | 重新构建索引     |
| `NETWORK_ERROR`          | 网络连接错误     | 检查网络连接     |

### 注意事项

1. **文件大小限制**: 单个文件不超过100MB

2. **支持格式**: PDF, DOCX, PPTX, TXT, JPG, PNG, MP3, MP4等

3. **并发限制**: 单个用户最多同时处理5个文档

4. **存储配额**: 根据用户权限有不同的存储空间限制

5. ### **异步处理**: 大文件建议使用异步上传和处理模式



## 二、检索接口设计

### 1. 统一检索接口

### 接口功能

支持多种模态的混合查询，系统自动识别查询类型并进行多模态检索。

### 请求参数

```json
POST /api/v1/retrieve/unified

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "query": {
    "text": string,                 // 可选，文本查询内容
    "image": string,                // 可选，图像base64编码或URL
    "audio": string,                // 可选，音频base64编码或URL
    "video": string,                // 可选，视频base64编码或URL
    "modality_weights": {           // 可选，各模态权重配置
      "text": number,               // 文本权重，默认1.0
      "image": number,              // 图像权重，默认1.0
      "audio": number,              // 音频权重，默认1.0
      "video": number               // 视频权重，默认1.0
    }
  },
  "search_config": {
    "collection_ids": string[],     // 可选，指定检索集合
    "max_results": number,          // 返回结果数量，默认10
    "score_threshold": number,      // 相似度阈值，默认0.5
    "search_filters": {             // 检索过滤条件
      "file_types": string[],       // 文件类型过滤
      "tags": string[],             // 标签过滤
      "categories": string[],       // 分类过滤
      "date_range": {               // 日期范围过滤
        "start": string,            // ISO时间戳
        "end": string
      },
      "min_file_size": number,      // 最小文件大小
      "max_file_size": number       // 最大文件大小
    },
    "rerank_enabled": boolean,      // 是否启用重排序，默认true
    "rerank_model": string,         // 重排序模型
    "diversification": {            // 结果多样化配置
      "enabled": boolean,           // 是否启用多样化
      "algorithm": "mmr",           // 多样化算法：mmr, clustering
      "diversity_weight": number    // 多样性权重
    }
  },
  "return_fields": {                // 指定返回字段
    "content": boolean,             // 是否返回内容
    "metadata": boolean,            // 是否返回元数据
    "vector": boolean,              // 是否返回向量
    "score": boolean,               // 是否返回相似度分数
    "modality_scores": boolean,     // 是否返回各模态分数
    "highlight": boolean            // 是否返回高亮片段
  },
  "context_config": {               // 上下文配置
    "include_context": boolean,     // 是否包含上下文
    "context_window": number,       // 上下文窗口大小
    "overlap_size": number          // 上下文重叠大小
  }
}
```

### 响应结果

```json
{
  "success": boolean,
  "data": {
    "query_id": string,             // 查询ID，用于追踪
    "results": [
      {
        "document_id": string,
        "chunk_id": string,         // 块ID
        "content": {                // 检索到的内容
          "text": string,           // 文本内容
          "image": string,          // 图像base64编码或URL
          "audio": string,          // 音频base64编码或URL
          "video": string,          // 视频base64编码或URL
          "highlight": string       // 高亮片段（文本）
        },
        "metadata": {               // 元数据
          "file_name": string,
          "file_type": string,
          "file_size": number,
          "created_at": string,
          "tags": string[],
          "category": string
        },
        "scores": {
          "overall": number,        // 总体相似度分数
          "text": number,           // 文本相似度分数
          "image": number,          // 图像相似度分数
          "audio": number,          // 音频相似度分数
          "video": number           // 视频相似度分数
        },
        "modality": "text" | "image" | "audio" | "video" | "multimodal", // 内容模态
        "collection_id": string,
        "context": {                // 上下文信息
          "previous_chunks": string[],
          "next_chunks": string[]
        }
      }
    ],
    "aggregations": {               // 聚合统计
      "by_modality": {              // 按模态聚合
        "text": number,
        "image": number,
        "audio": number,
        "video": number
      },
      "by_category": object,        // 按分类聚合
      "by_collection": object       // 按集合聚合
    },
    "search_metrics": {             // 搜索指标
      "total_matches": number,      // 总匹配数
      "search_time": number,        // 搜索耗时(ms)
      "rerank_time": number,        // 重排序耗时(ms)
      "index_used": string,         // 使用的索引
      "model_used": string          // 使用的模型
    },
    "suggestions": {                // 搜索建议
      "related_queries": string[],  // 相关查询
      "spelling_correction": string // 拼写纠正
    }
  },
  "error": {
    "code": string,
    "message": string,
    "details": object
  }
}
```

### 2. 文本检索接口

### 接口功能

基于文本内容的语义检索。

### 请求参数

```json
POST /api/v1/retrieve/text

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "query_text": string,             // 必需，查询文本
  "search_type": "semantic" | "keyword" | "hybrid", // 检索类型
  "search_config": {                // 同统一检索接口的search_config
    "collection_ids": string[],
    "max_results": number,
    "score_threshold": number,
    "search_filters": object,
    "rerank_enabled": boolean,
    "diversification": object
  },
  "language": string,               // 查询语言，如：zh-CN, en-US
  "query_expansion": {              // 查询扩展配置
    "enabled": boolean,             // 是否启用查询扩展
    "method": "synonym" | "llm" | "both", // 扩展方法
    "max_expansion_terms": number   // 最大扩展词数
  }
}
```

### 响应结果

同统一检索接口的响应格式，但结果主要包含图像内容。



### 3. 图像检索接口

### 接口功能

基于图像内容的视觉相似性检索。

### 请求参数

```
POST /api/v1/retrieve/image

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "query_image": string,            // 必需，图像base64编码或URL
  "search_type": "similarity" | "semantic" | "hybrid", // 检索类型
  "visual_features": {              // 视觉特征配置
    "color": boolean,               // 颜色特征
    "texture": boolean,             // 纹理特征
    "shape": boolean,               // 形状特征
    "object_detection": boolean,    // 目标检测
    "face_recognition": boolean     // 人脸识别
  },
  "search_config": {                // 同统一检索接口的search_config
    "collection_ids": string[],
    "max_results": number,
    "score_threshold": number,
    "search_filters": object,
    "rerank_enabled": boolean,
    "diversification": object
  }
}
```

### 响应结果

同统一检索接口的响应格式，但结果主要包含图像内容。

### 4. 跨模态检索接口

### 接口功能

使用一种模态查询另一种模态的内容（如图搜文、文搜图等）。

### 请求参数

```json
POST /api/v1/retrieve/cross-modal

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "source_modality": "text" | "image" | "audio" | "video", // 源模态
  "target_modality": "text" | "image" | "audio" | "video", // 目标模态
  "query_content": string,          // 查询内容（base64或文本）
  "cross_modal_model": string,      // 跨模态模型
  "search_config": {                // 同统一检索接口的search_config
    "collection_ids": string[],
    "max_results": number,
    "score_threshold": number,
    "search_filters": object,
    "rerank_enabled": boolean,
    "diversification": object
  }
}
```



### 响应结果

```
{
  "success": boolean,
  "data": {
    "query_id": string,
    "source_modality": string,
    "target_modality": string,
    "cross_modal_score": number,    // 跨模态匹配分数
    "results": [                    // 同统一检索接口的results
      // ...
    ],
    "search_metrics": {
      "cross_modal_time": number,   // 跨模态处理时间
      "alignment_score": number     // 模态对齐分数
    }
  }
}
```

### 5. 分层检索接口

### 接口功能

支持多级检索策略，先粗筛后精排。

### 请求参数

```json
POST /api/v1/retrieve/hierarchical

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "query": object,                  // 同统一检索接口的query
  "stages": [                       // 检索阶段配置
    {
      "stage": "coarse",            // 阶段类型：coarse, fine, rerank
      "method": "vector" | "keyword" | "hybrid",
      "max_candidates": number,     // 该阶段候选数量
      "score_threshold": number,    // 该阶段分数阈值
      "model": string               // 该阶段使用模型
    }
  ],
  "fusion_strategy": "weighted" | "reciprocal_rank" | "round_robin", // 结果融合策略
  "search_config": object           // 同统一检索接口的search_config
}
```

### 响应结果

```
{
  "success": boolean,
  "data": {
    "query_id": string,
    "stage_results": [              // 各阶段结果
      {
        "stage": string,
        "candidate_count": number,
        "stage_time": number,
        "candidates": object[]
      }
    ],
    "final_results": object[],      // 最终结果
    "fusion_scores": object         // 融合分数信息
  }
}
```

### 6. 会话检索接口

### 接口功能

支持多轮对话上下文感知的检索。

### 请求参数

```
POST /api/v1/retrieve/conversational

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "current_query": object,          // 当前查询，同统一检索接口的query
  "conversation_history": [         // 对话历史
    {
      "role": "user" | "assistant",
      "content": string,
      "timestamp": string,
      "modality": string
    }
  ],
  "context_window": number,         // 上下文窗口大小
  "query_rewriting": {              // 查询重写配置
    "enabled": boolean,
    "model": string,
    "preserve_original": boolean    // 是否保留原查询
  },
  "search_config": object           // 同统一检索接口的search_config
}
```

### 响应结果

```
{
  "success": boolean,
  "data": {
    "query_id": string,
    "original_query": object,       // 原始查询
    "rewritten_query": object,      // 重写后的查询
    "context_used": string[],       // 使用的上下文
    "results": object[],            // 同统一检索接口的results
    "conversation_context": {       // 对话上下文信息
      "relevant_turns": number[],   // 相关轮次
      "context_score": number       // 上下文相关性分数
    }
  }
}
```

### 7. 检索配置接口

### 接口功能

管理和配置检索参数和策略。

### 请求参数

```json
GET /api/v1/retrieve/config

// 响应
{
  "success": boolean,
  "data": {
    "available_models": {
      "text": string[],
      "image": string[],
      "audio": string[],
      "video": string[],
      "cross_modal": string[],
      "rerank": string[]
    },
    "default_config": {
      "max_results": number,
      "score_threshold": number,
      "rerank_enabled": boolean,
      "diversification_enabled": boolean
    },
    "supported_modalities": string[],
    "index_status": {
      "text_index": "ready" | "building" | "error",
      "image_index": "ready" | "building" | "error",
      "audio_index": "ready" | "building" | "error",
      "video_index": "ready" | "building" | "error"
    },
    "performance_metrics": {
      "average_response_time": number,
      "throughput": number,
      "cache_hit_rate": number
    }
  }
}
```



## 三.统一问答接口

### 接口功能

基于检索到的多模态内容进行智能问答，支持文本、图像、音频、视频等多种输入和输出。

### 请求参数

```json
POST /api/v1/qa/unified

// Headers
Content-Type: application/json
Authorization: Bearer {token}

// Body
{
  "question": {
    "text": string,                 // 文本问题
    "image": string,                // 图像base64编码或URL（用于视觉问答）
    "audio": string,                // 音频base64编码或URL（用于语音问答）
    "video": string,                // 视频base64编码或URL（用于视频问答）
    "modality": "text" | "image" | "audio" | "video" | "multimodal" // 问题模态
  },
  "context": {
    "collection_ids": string[],     // 指定检索集合
    "search_config": {              // 检索配置
      "max_retrieved_docs": number, // 最大检索文档数，默认5
      "score_threshold": number,    // 检索分数阈值
      "search_filters": object      // 检索过滤条件
    },
    "external_knowledge": {         // 外部知识配置
      "enabled": boolean,           // 是否启用外部知识
      "sources": ["web", "database", "api"], // 外部知识源
      "confidence_threshold": number // 外部知识置信度阈值
    }
  },
  "answer_config": {
    "format": "text" | "multimodal" | "structured", // 回答格式
    "detail_level": "concise" | "detailed" | "comprehensive", // 详细程度
    "citation_style": "none" | "inline" | "endnote", // 引用格式
    "language": string,             // 回答语言，如：zh-CN, en-US
    "max_length": number,           // 最大回答长度
    "temperature": number,          // 生成温度
    "avoid_hallucination": boolean, // 是否避免幻觉
    "confidence_threshold": number  // 回答置信度阈值
  },
  "multimodal_output": {            // 多模态输出配置
    "generate_images": boolean,     // 是否生成图像
    "generate_audio": boolean,      // 是否生成音频
    "generate_video": boolean,      // 是否生成视频
    "media_quality": "low" | "medium" | "high", // 生成媒体质量
    "synchronize_media": boolean    // 是否同步多模态输出
  },
  "streaming": boolean,             // 是否流式输出
  "session_id": string,             // 会话ID（用于多轮对话）
  "user_preferences": {             // 用户偏好
    "technical_level": "beginner" | "intermediate" | "expert", // 技术级别
    "preferred_modality": "text" | "visual" | "audio", // 偏好模态
    "learning_style": "analytical" | "practical" | "visual" // 学习风格
  }
}
```

### 响应结果（非流式）

```json
{
  "success": boolean,
  "data": {
    "answer_id": string,            // 回答ID
    "question": {                   // 解析后的问题
      "text": string,
      "intent": string,             // 问题意图分类
      "modality": string,
      "complexity": "simple" | "moderate" | "complex" // 问题复杂度
    },
    "answer": {
      "text": string,               // 文本回答
      "images": [                   // 生成的图像
        {
          "url": string,            // 图像URL或base64
          "caption": string,        // 图像描述
          "type": "generated" | "retrieved" // 图像类型
        }
      ],
      "audios": [                   // 生成的音频
        {
          "url": string,            // 音频URL或base64
          "transcript": string,     // 音频文本
          "duration": number        // 音频时长(秒)
        }
      ],
      "videos": [                   // 生成的视频
        {
          "url": string,            // 视频URL或base64
          "description": string,    // 视频描述
          "duration": number        // 视频时长(秒)
        }
      ],
      "structured_data": object,    // 结构化数据
      "summary": string             // 回答摘要
    },
    "citations": [                  // 引用来源
      {
        "document_id": string,
        "chunk_id": string,
        "content": string,          // 引用内容
        "modality": string,         // 内容模态
        "confidence": number,       // 引用置信度
        "page_number": number,      // 页码（如果适用）
        "timestamp": string         // 时间戳（音视频）
      }
    ],
    "confidence_metrics": {
      "overall_confidence": number, // 总体置信度
      "factual_confidence": number, // 事实性置信度
      "source_consistency": number, // 来源一致性
      "cross_modal_consistency": number // 跨模态一致性
    },
    "processing_metrics": {
      "retrieval_time": number,     // 检索耗时(ms)
      "generation_time": number,    // 生成耗时(ms)
      "total_time": number,         // 总耗时(ms)
      "tokens_used": number,        // 使用token数
      "sources_used": number        // 使用的来源数
    },
    "suggestions": {                // 相关建议
      "follow_up_questions": string[], // 后续问题建议
      "related_topics": string[],   // 相关主题
      "learning_resources": [       // 学习资源推荐
        {
          "title": string,
          "type": "document" | "video" | "audio" | "course",
          "url": string,
          "difficulty": string
        }
      ]
    },
    "warnings": [                   // 警告信息
      {
        "type": "low_confidence" | "conflicting_sources" | "incomplete_info",
        "message": string,
        "severity": "low" | "medium" | "high"
      }
    ]
  },
  "error": {
    "code": string,
    "message": string,
    "details": object
  }
}
```

### 流式响应格式

```
// 每个流式chunk的格式
{
  "type": "text" | "image" | "audio" | "video" | "citation" | "metric" | "end",
  "sequence": number,               // 序列号
  "data": {
    "content": string | object,     // 具体内容
    "modality": string              // 内容模态
  },
  "is_final": boolean               // 是否为最终chunk
}
```

## 2. 多轮对话问答接口

### 接口功能

支持基于对话历史的上下文感知问答。

### 请求参数

```
POST /api/v1/qa/conversational

// Body
{
  "current_question": object,       // 同统一问答接口的question
  "conversation_history": [         // 对话历史
    {
      "role": "user" | "assistant",
      "content": object,            // 同问答接口的answer格式
      "timestamp": string,
      "message_id": string
    }
  ],
  "conversation_context": {         // 对话上下文配置
    "memory_window": number,        // 记忆窗口大小（轮数）
    "topic_continuity": boolean,    // 是否保持话题连续性
    "personalization": {            // 个性化配置
      "user_knowledge_level": string,
      "preferred_explanations": string[],
      "avoided_topics": string[]
    }
  },
  "context": object,                // 同统一问答接口的context
  "answer_config": object           // 同统一问答接口的answer_config
}
```

### 响应结果

```
{
  "success": boolean,
  "data": {
    // 包含统一问答接口的所有字段
    "conversation_analysis": {
      "topic": string,              // 当前话题
      "topic_shift": boolean,       // 是否话题转移
      "user_interest_level": number, // 用户兴趣程度
      "recommended_depth": string   // 推荐回答深度
    },
    "context_usage": {              // 上下文使用情况
      "history_references": number, // 历史引用次数
      "context_relevance": number   // 上下文相关性
    }
  }
}
```

