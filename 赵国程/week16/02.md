### 1. redis list的index与Faiss的index不对应问题

lpush是左侧插入，faiss的add是右侧插入，index不对应

```python
def store(self, prompt: Union[str, List[str]], response: Union[str, List[str]]):
    if isinstance(prompt, str):
        prompt = [prompt]
        response = [response]

    embedding = self.embedding_method(prompt)
    if self.index is None:
        self.index = faiss.IndexFlatL2(embedding.shape[1])

    self.index.add(embedding)
    faiss.write_index(self.index, f"{self.name}.index")

    try:
        with self.redis.pipeline() as pipe:
            for q, a in zip(prompt, response):
                pipe.setex(self.name + "key:" + q, self.ttl, a) # 提问和回答存储在redis
                pipe.lpush(self.name + "list", q) #所有的提问都存储在list里面，方便后续使用

            return pipe.execute()
    except:
        import traceback
        traceback.print_exc()
        return -1
```

### 2. redis 键删除问题

`self.redis.delete(*pormpts)删除的并不是set的key，set的key格式为`self.name + "key:" + q`

```python
def clear_cache(self):
    pormpts = self.redis.lrange(self.name + "list", 0, -1)
    self.redis.delete(*pormpts)
    self.redis.delete(self.name + "list")
    os.unlink(f"{self.name}.index")
    self.index = None
```