### 接口响应通用参数
 - status: int 表示接口响应状态 0表示成功
 - message: str 表示接口响应信息
 - data: dict或者list 表示数据
### 接口设计
#### 数据管理接口
##### 创建知识库接口
  - 接口参数：
    - 标题
    - 用户ID
  - 接口响应：
    - 通用数据：成功、失败
  - 实现：
    - 生成新的知识库，插入到关系数据库
##### 上传文档接口
  - 接口参数：
    - 知识库ID
    - 文档标题
    - 文档文件
  - 接口响应：
    - 通用响应：成功、失败
    - data：字典格式，包括document_id，knowledge_id，document_title，document_path
  - 实现：
    - 生成文档信息数据，状态为处理中，插入到关系数据库中，包括：
      - document_id：文档ID
      - knowledge_id：知识库ID
      - document_title：文档标题
      - document_path：文档保存路径
      - state：状态
      - error_message：错误信息
    - 将文档信息数据通过Kafka交给单独解析服务处理
    - 消费服务获取文档信息数据开始处理
    - 使用mineru解析文档，按照Markdown格式提取文字、图片和表格
    - 图片单独一个chunk，表格单独一个chunk，分析可以拆分chunk
    - 元信息保存到关系数据库，包括：
      - chunk_id：块ID
      - document_id：文档ID
      - page_id：章节ID
      - text：文字格式为文本内容，图片格式为图片描述内容，表格格式为表格描述内容
      - vector_id：向量数据索引
    - embedding保存向量数据库，并外键关联到关系数据库的vector_id字段
      - 文本格式：文本内容BGE向量化 + 文本内容CLIP向量化
      - 表格格式：表格描述内容BGE向量化 + 表格内容CLIP向量化
      - 图片格式：图片描述内容BGE向量化 + 图片CLIP向量化
    - 如果解析失败，将文档信息数据状态改为失败，错误信息为解析失败原因
    - 如果解析成功，将文档信息数据状态改为成功
##### 删除文档接口
  - 接口参数：
    - 用户ID
    - 知识库ID
    - 文档ID
  - 接口响应：
    - 通用响应：成功、失败
    - data：空
  - 实现：
    - 是否有权限删除，只有自己才有权限删除
    - 通过关系型数据库查找文档信息和文档分块信息
    - 遍历文档分块信息查找引用的相关向量信息
    - 从关系数据库数据和向量库数据删除查找出来的信息
##### 更新文档接口
  - 接口参数：
    - 用户ID
    - 知识库ID
    - 文档ID
    - 文档章节ID
    - 文档文件
  - 接口响应：
    - 通用响应：成功、失败
    - data：空
  - 实现：
    - 是否有权限更新，只有自己才有权限更新
    - 将请求数据通过Kafka交给单独更新服务处理
    - 根据文档ID和章节ID查询相关分块信息和向量信息
    - 从关系数据库数据和向量库数据删除查找出来的信息
    - 重新解析文档章节内容，重新走添加文档的操作
##### 获取单个文档数据列表
  - 接口参数：
    - 知识库ID
    - 文档ID
  - 接口响应：
    - 通用响应：成功、失败
    - data：列表格式，列表每个Item = 文档信息 + 分块信息
  - 实现：
    - 根据文档ID从关系型数据库查找文档信息和文档分块信息
##### 获取所有文档数据列表
  - 接口参数：
    - 知识库ID
    - 最后一条数据ID，如果为空，表示从最开始获取，分页用到
    - 每页数量
  - 接口响应：
    - 通用响应：成功、失败
    - data：列表格式，列表每个Item = 文档信息 + 分块信息
  - 实现：
    - 通过关系型数据库查找文档相关数据列表，从最后一条数据ID获取每页数量的数据列表
    - 根据文档ID从关系型数据库查找文档信息和文档分块信息
#### 多模态检索接口
  - 接口参数；
    - 知识库ID
    - 检索文字
    - 检索图片
    - Top前多少个数据
  - 接口响应：
    - 通用相应：成功、失败
    - data：列表格式，列表每个Item = 文档信息 + 分块信息
  - 实现：
    - 只输入文字：
      - 使用BGE进行检索文字向量化，检索文本向量、图片描述向量、表格描述向量
      - 整合结果返回
    - 输入文字和图片：
      - 使用BGE进行检索文字向量化，检索文本向量、图片描述向量、表格描述向量
      - 使用CLIP进行文字向量化，检索文字、图片、表格
      - 使用CLIP进行图片向量化，检索文字、图片、表格
      - 整合结果返回
#### 多模态问答接口
  - 接口参数；
    - 知识库ID
    - 检索文字
    - 检索图片
  - 接口响应：
    - 通用相应：成功、失败
    - data：字典格式，大模型回答格式化数据
  - 实现：
    - 使用检索接口获取Top10数据
    - 放到提示词模板中
    - 输入大模型，输出格式化结果
