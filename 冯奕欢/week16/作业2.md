## Bug

### clear_cache 方法错误
 - 错误：
   - 参数错误
   - 文件不存在错误
 - 修正：
```python
def clear_cache(self):
    pormpts = self.redis.lrange(self.name + "list", 0, -1)
    if pormpts is not None:
        for pormpt in pormpts:
            self.redis.delete(*pormpt)
    self.redis.delete(self.name + "list")
    if os.path.exists(f"{self.name}.index"):
        os.unlink(f"{self.name}.index")
    self.index = None
```

### get_embedding 方法错误
 - 错误：
   - text没有真正转embedding
 - 修正：
```python
from sentence_transformers import SentenceTransformer
...
if __name__ == "__main__":
    # 加载模型
    model = SentenceTransformer('../../../models/BAAI/bge-small-zh-v1.5')
    # 获取文本的embedding方法
    def get_embedding(text):
        if isinstance(text, str):
            text = [text]
        return np.array([model.encode(t) for t in text])
    ...
```

### store 方法错误
 - 错误：
   - lpush错误，不是左边push，而是右边push
 - 修正：
```python
def store(self, prompt: Union[str, List[str]], response: Union[str, List[str]]):
    ...
    try:
        with self.redis.pipeline() as pipe:
            for q, a in zip(prompt, response):
                pipe.setex(self.name + "key:" + q, self.ttl, a) # 提问和回答存储在redis
                # 这里错误 应该rpush，不是lpush
                # pipe.lpush(self.name + "list", q) #所有的提问都存储在list里面，方便后续使用
                pipe.rpush(self.name + "list", q) #所有的提问都存储在list里面，方便后续使用
            return pipe.execute()
    except:
        import traceback
        traceback.print_exc()
        return -1
```

### 
 - 错误：
   - 索引错误
 - 修正：
```python
def call(self, prompt: str):
    ...
    # 过滤不满足距离的结果
    # 应该获取索引 不是直接用 dis索引
    # filtered_ind = [i for i, d in enumerate(dis[0]) if d < self.distance_threshold]
    filtered_ind = [ind[0][i] for i, d in enumerate(dis[0]) if d < self.distance_threshold]
    pormpts = self.redis.lrange(self.name + "list", 0, -1)
    print("pormpts", pormpts)
    filtered_prompts = [pormpts[i] for i in filtered_ind]

    # 获取得到原始的提问 ，并在redis 找到对应的回答
    return self.redis.mget([self.name + "key:"+ q.decode() for q in filtered_prompts])
```