# Stock-BI Agent 前后端接口文档

> 本文档统计 FastAPI 服务对前端开放的全部 HTTP 接口，包含 `/v1/*` 业务接口与 `/stock/*` 股票数据接口。所有接口默认返回 `BasicResponse`（code/message/data）或第三方 API 的原始 JSON。

## 1. 服务概览

- 主服务地址：`http://<host>:8000`
- 健康检查：`GET /v1/healthy`
- 业务模块前缀：`/v1/users`、`/v1/chat`、`/v1/data`、`/v1/stock`
- 底层股票数据：`/stock/*`（直接映射至 `api/autostock.py`）

## 2. 接口统计

| 分类 | 路径前缀 | 接口数量 | 说明 |
|------|----------|----------|------|
| 健康检查 | `/v1` | 1 | 服务自检 |
| 用户管理 | `/v1/users` | 7 | 登录、注册、资料维护 |
| 对话管理 | `/v1/chat` | 6 | 流式聊天与会话记录 |
| 数据管理 | `/v1/data` | 4 | 数据集占位接口（待实现） |
| 股票收藏 | `/v1/stock` | 4 | 用户自选股 CRUD |
| 股票基础 API | `/stock` | 10 | 调用 autostock 平台 |

## 3. 详细接口

### 3.1 `/v1` 基础

| 方法 | 路径 | 描述 | 请求示例 | 响应示例 |
|------|------|------|----------|----------|
| GET | `/v1/healthy` | 健康检查，占位 | 无 | `{"code":200,"message":"ok","data":[]}`（需自行实现） |

### 3.2 `/v1/users` 用户管理

| 方法 | 路径 | 描述 | 请求体 | 备注 |
|------|------|------|--------|------|
| POST | `/login` | 用户登录 | `{"user_name":"demo","password":"***"}` | 成功返回 200 |
| POST | `/register` | 用户注册 | `{"user_name":"","password":"","user_role":""}` | 用户名重复返回 400 |
| POST | `/reset-password` | 重置密码 | `{"user_name":"","password":"","new_password":""}` | 需先校验旧密码 |
| POST | `/info` | 获取用户信息 | 查询参数 `user_name` | 返回用户详细资料 |
| POST | `/reset-info` | 修改角色/状态 | `{"user_name":"","user_role":null,"status":null}` | 字段存在才更新 |
| POST | `/delete` | 删除用户 | 查询参数 `user_name` | 逻辑删除 |
| POST | `/list` | 用户列表 | 无 | 返回所有用户数组 |

### 3.3 `/v1/chat` 对话管理

| 方法 | 路径 | 描述 | 请求体 / 参数 | 返回 |
|------|------|------|---------------|------|
| POST | `/` | 发起/继续对话（SSE 流） | `RequestForChat`：`content,user_name,session_id,task,tools,...` | `text/event-stream` |
| POST | `/init` | 申请新的 `session_id` | 无 | `{"session_id":"xxxx"}` |
| POST | `/get` | 获取某会话所有消息 | 查询参数 `session_id` | 消息数组 |
| POST | `/delete` | 删除会话 | 查询参数 `session_id` | 200 / 500 |
| POST | `/list` | 用户会话列表 | 查询参数 `user_name` | `ChatSession[]` |
| POST | `/feedback` | 单条消息 thumbs-up/down | `session_id`,`message_id`,`feedback` | 200 |

### 3.4 `/v1/data` 数据管理（待实现）

| 方法 | 路径 | 描述 | 请求 | 备注 |
|------|------|------|------|------|
| POST | `/download` | 下载数据 | 待定义 | 函数体待实现 |
| POST | `/create` | 创建数据源 | 待定义 | 同上 |
| POST | `/upload` | 上传数据 | 待定义 |  |
| POST | `/delete` | 删除数据源 | 待定义 |  |

### 3.5 `/v1/stock` 用户自选股

| 方法 | 路径 | 描述 | 请求参数 | 返回 |
|------|------|------|----------|------|
| POST | `/list_fav_stock` | 查询用户收藏 | `user_name` | `StockFavInfo[]` |
| POST | `/del_fav_stock` | 删除单只收藏 | `user_name`,`stock_code` | `True/False` |
| POST | `/add_fav_stock` | 添加收藏 | `user_name`,`stock_code` | 重复返回 False |
| POST | `/clear_fav_stock` | 清空收藏 | `user_name` | `True` |

### 3.6 `/stock` 股票基础数据（FastAPI 子应用）

| 方法 | 路径 | 描述 | 主要参数 |
|------|------|------|----------|
| GET | `/get_stock_code` | 查询股票代码 | `keyword`（支持模糊） |
| GET | `/get_index_code` | 指数代码列表 | - |
| GET | `/get_industry_code` | 板块排行 | - |
| GET | `/get_board_info` | 大盘数据 | - |
| GET | `/get_stock_rank` | 股票排行榜 | `node,industryCode,pageIndex,pageSize,sort,asc` |
| GET | `/get_month_line` | 月 K 线 | `code,startDate,endDate,type` |
| GET | `/get_week_line` | 周 K 线 | 同上 |
| GET | `/get_day_line` | 日 K 线 | 同上 |
| GET | `/get_stock_info` | 个股基础信息 | `code` |
| GET | `/get_stock_minute_data` | 分时行情 | `code` |

> 以上 10 个接口直接转发至 autostock 平台，返回其原始 JSON 数据。

## 4. 响应结构说明

绝大多数 `/v1/*` 接口统一返回：

```json
{
  "code": 200,
  "message": "ok",
  "data": [...]
}
```

- `code`: 业务状态码（200 成功、400 参数/用户错误、404 内部异常、500 未捕获异常）
- `message`: 人类可读提示
- `data`: 业务数据，可能为对象、数组或空列表


